<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="habitTracker.mapper.HabitTrackerMapper">

	<!-- 습관 목록 조회 -->
	<select id="openHabitList" resultType="habitTracker.dto.HabitDto">
	SELECT habit_idx, habit_content, DATE_FORMAT(regist_dt, '%Y-%m-%d') as regist_dt
	  FROM t_habit
	 WHERE delete_yn = 'N'
	   AND DATE_FORMAT(regist_dt, '%Y-%m') = DATE_FORMAT(now(), '%Y-%m')
  ORDER BY regist_dt desc
	</select>
	
	<!-- 습관 추가 -->
	<insert id="addHabit" parameterType="habitTracker.dto.HabitDto">
	INSERT INTO t_habit (habit_content, regist_dt, delete_yn)
	     VALUES (#{habitContent}, now(), 'N')
	</insert>
	
	<!-- 습관 수정 -->
	<update id="editHabit" parameterType="habitTracker.dto.HabitDto">
	UPDATE t_habit
	   SET habit_content = #{habitContent}
	 WHERE habit_idx = #{habitIdx}
	</update>
	
	<!-- 습관 삭제 -->
	<update id="deleteHabit" parameterType="INTEGER">
	UPDATE t_habit
	   SET delete_yn = 'Y'
	 WHERE habit_idx = #{habitIdx}
	</update>
	
	<!-- 습관 상세 페이지 -->
	<select id="openHabitDetail" resultType="habitTracker.dto.HabitDto">
	SELECT habit_idx, habit_content, DATE_FORMAT(regist_dt, '%Y-%m-%d') as regist_dt
	  FROM t_habit
	 WHERE delete_yn = 'N'
	   AND habit_idx = #{habitIdx}
	</select>
	
	<!-- 습관 실행 여부 체크 -->
	<insert id="checkHabit" parameterType="habitTracker.dto.HabitHistoryDto">
	INSERT INTO t_habit_history (habit_idx, done_dt)
	     VALUES (#{habitIdx}, DATE_FORMAT(now(), '%Y-%m-%d'))
	</insert>
	
	<!-- 습관 실행 여부 체크 해제 -->
	<delete id="unCheckHabit" parameterType="habitTracker.dto.HabitHistoryDto">
	 DELETE FROM t_habit_history
	  WHERE habit_idx = #{habitIdx}
	    AND done_dt = DATE_FORMAT(#{doneDt}, '%Y-%m-%d'))
	</delete>
	
	<!-- 월별 습관 목록 조회 -->
	<select id="openHabitListByMonth" resultType="habitTracker.dto.HabitDto">
	SELECT habit_idx, habit_content, DATE_FORMAT(regist_dt, '%Y-%m-%d') as regist_dt
	  FROM t_habit
	 WHERE delete_yn = 'N'
	   AND DATE_FORMAT(regist_dt, '%Y-%m') = DATE_FORMAT(#{registDt}, '%Y-%m')
  ORDER BY regist_dt desc
  	</select>
</mapper>